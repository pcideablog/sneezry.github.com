<html>
<head>
<title>Quick Sort</title>
</head>
<body>
<style>
#bars {
    width: 100%;
}

#bars div {
    float: left;
    width: 1px;
    margin-right: 1px;
    background: black;
}

#bars div.sort {
    background: red;
}
</style>
<div id="bars"></div>
<script>
function quicksort(p) {
    var left = p+1;
    var right = array.length-1;
    var sorted = false;

    while (left < right) {
        if (array[left] < array[p]) {
            left++;
        } else if (array[right] >= array[p]) {
            right--;
        } else {
            sortArray.push([left, right]);
            var tmp = array[left];
            array[left] = array[right];
            array[right] = tmp;
            sorted = true;
        }
    }

    if (array[left] < array[p]) {
        sortArray.push([left, p]);
        var tmp = array[left];
        array[left] = array[p];
        array[p] = tmp;
        sorted = true;
    } else if (array[right-1] < array[p]) {
        sortArray.push([p, right-1]);
        var tmp = array[right-1];
        array[right-1] = array[p];
        array[p] = tmp;
        sorted = true;
    }

    if (!sorted) {
        p++;
    }

    if (p === array.length-2) {
        draw(0);
    } else {
        quicksort(p);
    }
}

function init() {
    var html = '';
    for(var i=0; i<array.length; i++) {
        html += '<div style="height:'+array[i]+'px"></div>';
    }
    document.getElementById('bars').innerHTML = html;
    quicksort(0);
}

function draw(i) {
    sort(sortArray[i][0], sortArray[i][1]);
    if(i === sortArray.length-1) {
        done(0);
    }
    setTimeout(function(){
        draw(i+1);
    }, 20);
}

function sort(a, b) {
    var tmp = array2[a];
    array2[a] = array2[b];
    array2[b] = tmp;
    var bars =  document.getElementById('bars').getElementsByTagName('div');
    bars[a].style.height = array2[a]+'px';
    bars[b].style.height = array2[b]+'px';
    bars[a].className = 'sort';
    bars[b].className = 'sort';
    setTimeout(function(){
        bars[a].className = '';
        bars[b].className = '';
    }, 20);
}

function done(i) {
    var bars =  document.getElementById('bars').getElementsByTagName('div');
    if(i===bars.length){
        bars[i-1].className = '';
        return;
    }
    setTimeout(function(){
        bars[i].className = 'sort';
        if(i>0) {
            bars[i-1].className = '';
        }
        done(i+1);
    }, 10);
}

var array2 = [];
var array = [];
var sortArray = [];

for(var i=0; i<500; i++){
    array2.push(i/2+200);
}

for(var i=0; i<500; i++){
    array.push(array2.splice(Math.round(Math.random()*10000)%array2.length,1));
}

array2 = array.join(',').split(',');

init();
</script>
</body>
</html>
