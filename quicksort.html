<html>
<head>
<title>Quick Sort</title>
</head>
<body>
<style>
#bars {
    width: 100%;
}

#bars div {
    float: left;
    width: 1px;
    margin-right: 1px;
    height: 500px;
    position: relative;
}

#bars div.sort:after {
    content: "";
    position: absolute;
    bottom: -4px;
    left: -1px;
    width: 3px;
    height: 3px;
    background: red;
}
</style>
<div id="bars"></div>
<script>
function quicksort(p) {
    if (p === array.length-1) {
        draw(0);
        return;
    }

    var left = p+1;
    var right = array.length-1;
    var sorted = false;

    while (left < right) {
        if (array[left] < array[p]) {
            left++;
        } else if (array[right] >= array[p]) {
            right--;
        } else {
            sortArray.push([left, right]);
            var tmp = array[left];
            array[left] = array[right];
            array[right] = tmp;
            sorted = true;
        }
    }

    if (array[left] < array[p]) {
        sortArray.push([left, p]);
        var tmp = array[left];
        array[left] = array[p];
        array[p] = tmp;
        sorted = true;
    } else if (array[right-1] < array[p]) {
        sortArray.push([p, right-1]);
        var tmp = array[right-1];
        array[right-1] = array[p];
        array[p] = tmp;
        sorted = true;
    }

    if (!sorted) {
        p++;
    }

    quicksort(p);
}

function init() {
    var html = '';
    var r, g;
    for(var i=0; i<array.length; i++) {
        r = Math.min(array[i], 250);
        g = Math.max(array[i] - 250, 0);
        html += '<div style="background: rgba('+r+','+g+',255,1)"></div>';
    }
    document.getElementById('bars').innerHTML = html;
    quicksort(0);
}

function draw(i) {
    sort(sortArray[i][0], sortArray[i][1]);
    if(i === sortArray.length-1) {
        done(0);
        return;
    }
    setTimeout(function(){
        draw(i+1);
    }, 20);
}

function sort(a, b) {
    var tmp = array2[a];
    var r, g, r2, g2;
    array2[a] = array2[b];
    array2[b] = tmp;
    var bars =  document.getElementById('bars').getElementsByTagName('div');
    r = Math.min(array2[a], 250);
    g = Math.max(array2[a] - 250, 0);
    r2 = Math.min(array2[b], 250);
    g2 = Math.max(array2[b] - 250, 0);
    bars[a].style.background = 'rgba('+r+','+g+',255,1)';
    bars[b].style.background = 'rgba('+r2+','+g2+',255,1)';
    bars[a].className = 'sort';
    bars[b].className = 'sort';
    setTimeout(function(){
        bars[a].className = '';
        bars[b].className = '';
    }, 20);
}

function done(i) {
    var bars =  document.getElementById('bars').getElementsByTagName('div');
    if(i===bars.length){
        bars[i-1].className = '';
        return;
    }
    setTimeout(function(){
        bars[i].className = 'sort';
        if(i>0) {
            bars[i-1].className = '';
        }
        done(i+1);
    }, 0);
}

var array2 = [];
var array = [];
var sortArray = [];

for(var i=0; i<500; i++){
    array2.push(i);
}

for(var i=0; i<500; i++){
    array.push(array2.splice(Math.round(Math.random()*10000)%array2.length,1)[0]);
}

array2 = array.join(',').split(',');

init();
</script>
</body>
</html>
