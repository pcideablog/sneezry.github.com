很抱歉给大家带来了不必要的麻烦，今天早上陆续收到小伙伴们（包括一个微博后端的童鞋……）的消息，询问为何在刷屏，打开微博一看果然又在刷屏（为什么说又，因为刷了好几次了），但恐怖的是这次非比寻常，已经刷了四个多小时了……既然这次玩大了，我想应该给小伙伴们一个解释（即使这样也才掉了四个粉，我太爱你们了~其实也许是大部分人还没睡醒……）。

我在家里放了一个Raspberry Pi做迷你服务器，在学校可以远程登录玩一玩，不过有一个问题就是家里虽然是光纤，但却没有固定ip（就是那种传说中坑爹的isp到小区最后一公里光纤，一公里之后还是adsl那鸟样），所以我就在pi上通过corn定时（每分钟）运行一个py脚本，然后这个脚本会fetch我在sae（新浪云计算）上的一个页面。当这个页面获取到来自pi的请求后，同时也获取到了pi的当前ip，之后将这个ip与保存在kvdb（新浪云计算特有的nosql数据库）的记录进行对比，如果一致则说明ip没有变动，不执行任何操作，如果不一致说明ip有变化，把最新的ip保存在kvdb中，同时调用dnspod的接口更新dns记录，再在Q.S上发出一条通知。

整个工作流程就是这样，但是从昨天23时起，sae先是全面宕机，官方给出的说明是机房核心服务器掉电（尼玛这也可以，不是说好了实习生不许碰电源插头的吗，掀桌），从我的记录来看，sae页面访问恢复的时间应该在凌晨两点多左右，足足宕机了三个小时。虽然sae的页面已经可以访问了，同时在凌晨3:30分左右的时候，kvdb开始出现问题，sae获取ip的页面无法读取出保存在数据库中ip的记录，于是开始发出ip更改通知，同时新的数据也无法写入进去。

就这样，虽然ip并没有更改，但是sae中的页面无法正常读取出记录，也无法写入新记录，导致通知没隔一分钟都会在微博上发一遍，当被发现时，已经足足发了四个小时。但是微博是不允许连续发布两条相同内容的，为何相同的内容可以持续刷屏将近五个小时？微博后端的童鞋给出的解释是一分钟超出了微博限定的阈值，也就是说两条内容相同的微博间隔一分钟可以发出。

既然问题已经查出，那么如何进行改进呢？由于sae频繁出现问题，这种服务器性能的不稳定导致的问题我很难进行掌控，换句话说如果sae不在性能上加强稳定性的保证，我这边也很难做些什么。不过我现在已经决定暂时停止了pi报告ip的功能，同时会将每分钟更新ip记录延长到每十分钟，这样即便kvdb再出问题，也只是增加dnspod的调用频率，不过每小时六次也不算是ddos攻击。

最后再次向本次事件影响的小伙伴表示歉意，同时也希望sae能更加稳定。
