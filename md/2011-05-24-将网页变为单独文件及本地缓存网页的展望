2011-05-24-将网页变为单独文件及本地缓存网页的展望
开始想到的标题是“富媒体嵌入单独页面的方法”，后来想想这样蹩脚的标题会使大部分人摸不到头脑。大家或许都知道，网页文件不像word文件那样会把图片、排版格式等信息嵌入到一个单独的文件中，当我们保存一个网页时，往往还会有一个包含该网页所需外部媒体文件的文件夹，当我们删除这个文件夹后，所保存的网页中所有图片和排版版式都会消失。Internet Explorer提供了一个允许将所有网页内容保存为一个单独的mht文件的功能，但所保存的mht文件往往会错版，使网页面目全非，另外mht的兼容性也很差，除IE外，Chrome、Safari、Firefox和Opera对其都不能很好地显示。<br>最近我在开发一款新的插件，按照原计划，该插件将会使离线浏览网页成为可能。首先该插件对网页引用的外部图片进行base64编码以嵌入到网页中，其次对网页外部css进行处理，处理的方法是将background中的url统一变为绝对地址，然后对css内容进行encodeURI编码后嵌入到网页中。在开发过程中，我也对外部js进行了处理，但实验效果并不理想，当将js嵌入网页后，离线浏览时会明显拖慢渲染速度，所以后来屏蔽掉了js的处理。<br>通过以上步骤之后，一个含有外部资源的页面完全被转化成了一个只含字符的单独文件，这样对本地存储和文件传输都非常方便。由于localStorage只支持string对象，所以这样处理后的网页可以保存到localStorage中，插件通过调用localStorage中的数据就可以实现离线浏览，而且浏览体验也非常好。<br>当然，如果只针对用户自身来说，缓存看过的网页似乎并没有什么必要，除非是对那些很少有机会接触网络的人才会一有上网机会就疯狂缓存大量想要日后浏览的网页。那么对于大多数用户，我想共享个人缓存具有更大的实际意义——只要有用户浏览过某网页将其缓存，并且愿意将其与他人共享，那么你就可以看到这个网页，无论这个网页是否可以正常访问，即使它已经不再存在。<br>本来到目前为止，相对于我最原始的计划来说，所做的工作还非常少，并没有向大家汇报的价值，但一是时间拖得有点长，一个简单的将图片编码成base64就搞了好几天，期间遇到的最棘手的问题就是跨域权限问题，后来Google了许久终于找到了解决方法；二是我认为目前的工作如果抛开之前的计划还是值得公布一下的，毕竟将网页保存为一个和原始网页几乎一样而且兼容性良好的单独文件的方法到目前为止恐怕还都没有先例。<br>虽然目前的工作还算顺利，但我依然可以感受到以后工作所面临的困难。一就是隐私问题，这也是最重要的问题。网页往往会包含用户的个人信息，比如当你访问google.com时，网页右上角就可能会出现你的gmail地址。虽然我保证插件在根据用户的设置与他人共享缓存前会提示用户，但大部分用户可能也并不会去认真地检查即将上传的页面是否包含个人信息而直接允许。二是数据存储空间问题。一个普通的网页可能只要几十k甚至只有几k，但内嵌了图片和css的网页却可能会达到几百k，甚至是几兆！按照保守估计，平均每个网页大小1MB，如果使用Google Storage保存，总空间大小100GB，那么我可以缓存100,000张网页，但对于庞大的互联网，只能算是九牛一毛。另外还有上传速度和流量的问题，这些问题都可能会使最终要达到的共享缓存这一宏伟计划“难产”。<br>当然就算我最终无法单独靠自身能力达到这样的目标，也很愿意将自己的这一想法与大家共享，希望有能力的人来最终完成这一工作。<br>最后给大家展示一下我编写的插件所转化的<a href="http://commondatastorage.googleapis.com/localcache/Wikipedia.html">维基百科首页</a>，请大家注意这个网页没有引用任何外部资源，当你保存网页时选择“仅保存html”后，会发现即使离线浏览，这个网页看起来依然很舒服，这就类似于word文件，所有媒体文件都已经内嵌到一个单独的文件中了。另外我别有用心地将IE保存的<a href="http://commondatastorage.googleapis.com/localcache/Wikipedia.mht">mht文件</a>一并发了上来供大家对比 :P<br>PS. 什么？想要那个插件？因为目前只做了转化网页的功能，除了使用另存为可以把网页保存为一个单独文件外还没什么其他实际用处，如果你非得尝个新鲜……那么给我发邮件吧~ <img src="http://m3.img.libdd.com/farm5/35/9E153EA7420FFB70AF214CB34A842A23_130_23.GIF"><br><span><strong>UPDATE:</strong></span> 昨夜仓促，今日重审此文发现错字连篇、语句不通，故认真进行修改，向大家表示歉意。换了新电脑键盘找不准了~外加ubuntu下没有给力的pinyin输入法*&#^@%^#!!!!!

