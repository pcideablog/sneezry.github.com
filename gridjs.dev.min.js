/*
 GridJS
 (c) 2015 Sneezry http://gridjs.org
 License: MIT
*/
(function(B,z,m){function C(a,b){h=h||z.createElement("canvas");var f,e,c,d=h.getContext("2d"),g=new Image;g.addEventListener("load",function(){f=g.width;e=g.height;h.width=f;h.height=e;d.drawImage(g,0,0);c=d.getImageData(0,0,f,e);b(c)},!1);g.src=a}function u(a){var b,f,e=a.width,c=a.height,d=a.data,g={r:[],g:[],b:[],a:[]};for(b=0;b<c;b++)for(g.r[b]=[],g.g[b]=[],g.b[b]=[],g.a[b]=[],a=0;a<e;a++)f=4*(b*e+a),g.r[b][a]=d[f],g.g[b][a]=d[f+1],g.b[b][a]=d[f+2],g.a[b][a]=d[f+3]/255;return g}function w(a){var b,
f,e=a.width,c=a.height,d=a.data,g={G:[],a:[]};for(b=0;b<c;b++)for(g.G[b]=[],g.a[b]=[],a=0;a<e;a++)f=4*(b*e+a),g.G[b][a]=d[f],g.a[b][a]=d[f+3]/255;g.r=g.G;g.g=g.G;g.b=g.G;return g}function y(a){var b,f,e,c=a.a[0].length,d=a.a.length,g=h.getContext("2d").createImageData(c,d);for(f=0;f<d;f++)for(b=0;b<c;b++)e=4*(f*c+b),a.G!==m?(g.data[e]=a.G[f][b],g.data[e+1]=a.G[f][b],g.data[e+2]=a.G[f][b]):(g.data[e]=a.r[f][b],g.data[e+1]=a.g[f][b],g.data[e+2]=a.b[f][b]),g.data[e+3]=Math.round(255*a.a[f][b]);return g}
function A(a){var b=v.getContext("2d");v.width=a.width;v.height=a.height;b.putImageData(a,0,0);return v}var r=B.gridjs=B.gridjs||{},h=z.createElement("canvas"),v=z.createElement("canvas"),k;k=function(){this.originTop=this.originLeft=this.origin=this.imageData=this.pixel=this.height=this.width=null};r.getImageObject=function(a,b){"string"===typeof a?r.getImageObjectFromURL(a,b):!0===Array.isArray(a.r)?b(r.getImageObjectFromPixel(a)):"object"===typeof a&&b(r.getImageObjectFromImageData(a))};r.open=
r.getImageObject;r.getImageObjectFromURL=function(a,b){C(a,function(a){var e=new k;e.imageData=a;e.pixel=u(a);e.width=a.width;e.height=a.height;b(e)})};r.getImageObjectFromImageData=function(a){var b=a.width,f=a.height,e=u(a),c=new k;c.pixel=e;c.imageData=a;c.height=f;c.width=b;return c};r.getImageObjectFromPixel=function(a){var b=a.a[0].length,f=a.a.length,e=y(a),c=new k;c.pixel=a;c.imageData=e;c.height=f;c.width=b;return c};r.convolution=function(a,b){var f,e,c,d,g,h,l,m=[],n=a[0].length,r=a.length,
k=b[0].length,u=b.length,t=Math.round(k/2)-1,p=Math.round(u/2)-1;for(e=0;e<r;e++)for(m[e]=[],f=0;f<n;f++){for(d=l=0;d<u;d++)for(c=0;c<k;c++)g=f-t+c,h=e-p+d,0<=g&&g<n&&0<=h&&h<r&&(l+=a[h][g]*b[d][c]);m[e][f]=l}return m};r.conv=r.convolution;r.abs=function(a){var b,f,e=[],c=a[0].length,d=a.length;for(f=0;f<d;f++)for(e[f]=[],b=0;b<c;b++)e[f][b]=Math.abs(a[f][b]);return e};r.square=function(a){var b,f,e=[],c=a[0].length,d=a.length;for(f=0;f<d;f++)for(e[f]=[],b=0;b<c;b++)e[f][b]=a[f][b]*a[f][b];return e};
r.sqrt=function(a){var b,f,e=[],c=a[0].length,d=a.length;for(f=0;f<d;f++)for(e[f]=[],b=0;b<c;b++)e[f][b]=Math.sqrt(a[f][b]);return e};r.gauseCore=function(a,b,f){var e,c,d,g,h=0,l=Math.round(a/2),q=[];b=b||1;for(c=0;c<a;c++)for(q[c]=[],e=0;e<a;e++){if(e<l&&c<l)switch(d=e-l+1,g=c-l+1,f){case 0:q[c][e]=-d*Math.exp(-(d*d+g*g)/(2*b*b))/(b*b*b);break;case 1:q[c][e]=-g*Math.exp(-(d*d+g*g)/(2*b*b))/(b*b*b);break;case 2:q[c][e]=d*g*Math.exp(-(d*d+g*g)/(2*b*b))/(b*b*b*b*b);break;default:q[c][e]=Math.exp(-(d*
d+g*g)/(2*b*b))/b}else q[c][e]=e<l?1===f||2===f?-q[a-c-1][e]:q[a-c-1][e]:c<l?0===f||2===f?-q[c][a-e-1]:q[c][a-e-1]:0===f||1===f?-q[a-c-1][a-e-1]:q[a-c-1][a-e-1];h+=Math.abs(q[c][e])}if(f!==m)for(c=0;c<a;c++)for(e=0;e<a;e++)q[c][e]/=h;return q};r.gauss=function(a,b,f,e){b=r.gauseCore(b,f,e);return r.convolution(a,b)};r.add=function(a,b){var f,e,c=[],d=a[0].length,g=a.length;for(e=0;e<g;e++)for(c[e]=[],f=0;f<d;f++)c[e][f]=a[e][f]+b[e][f];return c};r.minus=function(a,b){var f,e,c=[],d=a[0].length,g=
a.length;for(e=0;e<g;e++)for(c[e]=[],f=0;f<d;f++)c[e][f]=a[e][f]-b[e][f];return c};r.multiply=function(a,b){var f,e,c=[],d=a[0].length,g=a.length;for(e=0;e<g;e++)for(c[e]=[],f=0;f<d;f++)c[e][f]=a[e][f]*(Array.isArray(b)?b[e][f]:b);return c};r.mul=r.multiply;r.divide=function(a,b,f){var e,c,d,g=[],h=a[0].length,l=a.length;for(c=0;c<l;c++)for(g[c]=[],e=0;e<h;e++)d=Array.isArray(b)?b[c][e]:b,g[c][e]=f!==m?0===d?f:a[c][e]/d:a[c][e]/d;return g};r.div=r.divide;r.zeros=function(a,b){Array.isArray(a)&&(b=
a.length,a=a[0].length);return r.ones(a,b,0)};r.ones=function(a,b,f){var e,c,d=[];Array.isArray(a)&&(f=b,b=a.length,a=a[0].length);f=f===m?1:f;for(c=0;c<b;c++)for(d[c]=[],e=0;e<a;e++)d[c][e]=f;return d};r.normalize=function(a,b,f){var e,c,d,g,h=a[0].length,l=a.length;b=b===m?0:b;f=f===m?1:f;for(c=0;c<l;c++)for(e=0;e<h;e++){if(d===m||d>a[c][e])d=a[c][e];if(g===m||g<a[c][e])g=a[c][e]}for(c=0;c<l;c++)for(e=0;e<h;e++)a[c][e]=(a[c][e]-d)*(f-b)/(g-d)+b;return a};r.norm=r.normalize;r.cutoff=function(a,b){var f,
e,c=a[0].length,d=a.length;for(e=0;e<d;e++)for(f=0;f<c;f++)a[e][f]=Math.min(a[e][f],b);return a};r.kmeans=function(a,b,f,e,c){var d,g,h,l,q,n,k,u,x,t=a.length,p=[],w=[],v=[];e=e||0;f=f||20;if(c===m)for(c=[],h=0;h<b;h++)d=a[h][0],g=a[h][1],c[h]=[d,g];for(h=0;h<t;h++){k=null;d=a[h][0];g=a[h][1];for(l=0;l<b;l++)if(n=(d-c[l][0])*(d-c[l][0])+(g-c[l][1])*(g-c[l][1]),null===k||k>n)k=n,u=d,x=g,q=l;w[q]===m?(w[q]=[u,x],v[q]=1):(w[q][0]+=u,w[q][1]+=x,v[q]++);e+1>f&&(p[q]===m&&(p[q]=[]),p[q].push([u,x]))}for(l=
0;l<b;l++)w[l]===m?(c[l][0]=a[l][0],c[l][1]=a[l][1]):(c[l][0]=w[l][0]/v[l],c[l][1]=w[l][1]/v[l]);return e+1>f?{center:c,cluster:p}:r.kmeans(a,b,f,e+1,c)};r.blank=function(a,b,f){var e=new k,c=h.getContext("2d");f===m&&(f=[]);f[0]=f[0]||0;f[1]=f[1]||0;f[2]=f[2]||0;f[3]=f[3]||0;h.width=a;h.height=b;c.fillStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";c.fillRect(0,0,a,b);e.width=a;e.height=b;e.imageData=c.getImageData(0,0,a,b);e.pixel=u(e.imageData);return e};k.prototype.grayscale=function(){var a,
b,f,e=this.width,c=this.height,d={G:[],a:[]};for(b=0;b<c;b++)for(d.G[b]=[],d.a[b]=[],a=0;a<e;a++)f=.299*this.pixel.r[b][a]+.587*this.pixel.g[b][a]+.114*this.pixel.b[b][a],d.G[b][a]=Math.round(f),d.a[b][a]=this.pixel.a[b][a];d.r=d.G;d.g=d.G;d.b=d.G;this.pixel=d;this.imageData=y(d);return this};k.prototype.show=function(a){var b;"CANVAS"===a.tagName?(a.width=this.width,a.height=this.height,b=a.getContext("2d"),b.putImageData(this.imageData,0,0)):"IMG"===a.tagName&&(h.width=this.width,h.height=this.height,
b=h.getContext("2d"),b.putImageData(this.imageData,0,0),a.src=h.toDataURL());return this};k.prototype.blend=function(a,b,f,e){var c,d,g=this.width,h=this.height,l=a.width,m=a.height,n={r:[],g:[],b:[],a:[]};b=b||0;f=isNaN(f)?0:Math.round(f);e=isNaN(e)?0:Math.round(e);for(d=0;d<h;d++)for(n.r[d]=[],n.g[d]=[],n.b[d]=[],n.a[d]=[],c=0;c<g;c++)0>d-e||0>c-f||d-e>=m||c-f>=l?(n.a[d][c]=this.pixel.a[d][c],n.r[d][c]=this.pixel.r[d][c],n.g[d][c]=this.pixel.g[d][c],n.b[d][c]=this.pixel.b[d][c]):0===b?(n.a[d][c]=
a.pixel.a[d-e][c-f]+this.pixel.a[d][c]*(1-a.pixel.a[d-e][c-f]),n.r[d][c]=(a.pixel.r[d-e][c-f]*a.pixel.a[d-e][c-f]+this.pixel.r[d][c]*this.pixel.a[d][c]*(1-a.pixel.a[d-e][c-f]))/n.a[d][c],n.g[d][c]=(a.pixel.g[d-e][c-f]*a.pixel.a[d-e][c-f]+this.pixel.g[d][c]*this.pixel.a[d][c]*(1-a.pixel.a[d-e][c-f]))/n.a[d][c],n.b[d][c]=(a.pixel.b[d-e][c-f]*a.pixel.a[d-e][c-f]+this.pixel.b[d][c]*this.pixel.a[d][c]*(1-a.pixel.a[d-e][c-f]))/n.a[d][c]):(n.a[d][c]=this.pixel.a[d][c]+a.pixel.a[d-e][c-f]*(1-this.pixel.a[d][c]),
n.r[d][c]=(this.pixel.r[d][c]*this.pixel.a[d][c]+a.pixel.r[d-e][c-f]*a.pixel.a[d-e][c-f]*(1-this.pixel.a[d][c]))/n.a[d][c],n.g[d][c]=(this.pixel.g[d][c]*this.pixel.a[d][c]+a.pixel.g[d-e][c-f]*a.pixel.a[d-e][c-f]*(1-this.pixel.a[d][c]))/n.a[d][c],n.b[d][c]=(this.pixel.b[d][c]*this.pixel.a[d][c]+a.pixel.b[d-e][c-f]*a.pixel.a[d-e][c-f]*(1-this.pixel.a[d][c]))/n.a[d][c]),n.r[d][c]=Math.round(n.r[d][c]),n.g[d][c]=Math.round(n.g[d][c]),n.b[d][c]=Math.round(n.b[d][c]),.003>n.a[d][c]&&(n.a[d][c]=this.pixel.a[d][c]);
this.width=g;this.height=h;this.pixel=n;this.imageData=y(n);return this};k.prototype.copy=function(){var a,b,f=this.width,e=this.height,c=new k,d={a:[]};this.pixel.G!==m?d.G=[]:(d.r=[],d.g=[],d.b=[]);for(b=0;b<e;b++)for(this.pixel.G!==m?d.G[b]=[]:(d.r[b]=[],d.g[b]=[],d.b[b]=[]),d.a[b]=[],a=0;a<f;a++)this.pixel.G!==m?d.G[b][a]=this.pixel.G[b][a]:(d.r[b][a]=this.pixel.r[b][a],d.g[b][a]=this.pixel.g[b][a],d.b[b][a]=this.pixel.b[b][a]),d.a[b][a]=this.pixel.a[b][a];this.pixel.G!==m&&(d.r=d.G,d.g=d.G,d.b=
d.G);c.pixel=d;c.imageData=y(d);c.height=e;c.width=f;return c};k.prototype.resize=function(a,b){var f=h.getContext("2d"),e=A(this.imageData);1>a&&(a*=this.width,a=Math.round(a));1>b&&(b*=this.height,b=Math.round(b));h.width=a;h.height=b;f.drawImage(e,0,0,a,b);this.width=a;this.height=b;this.imageData=f.getImageData(0,0,a,b);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.rotate=function(a){var b=this.width,f=this.height;a=-a*Math.PI/180;var e=h.getContext("2d"),
c=A(this.imageData),d,g;d=Math.abs(b*Math.cos(a))+Math.abs(f*Math.sin(a));d=Math.round(d);g=Math.abs(b*Math.sin(a))+Math.abs(f*Math.cos(a));g=Math.round(g);h.width=d;h.height=g;e.translate(d/2,g/2);e.rotate(a);e.translate(-b/2,-f/2);e.drawImage(c,0,0);this.width=d;this.height=g;this.imageData=e.getImageData(0,0,d,g);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.crop=function(a,b,f,e){var c=h.getContext("2d"),d=A(this.imageData);h.width=f;h.height=e;c.drawImage(d,
a,b,f,e,0,0,f,e);this.width=f;this.height=e;this.imageData=c.getImageData(0,0,f,e);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.updateImageData=function(){var a=h.getContext("2d");this.pixel.G!==m&&(this.pixel.r=this.pixel.G,this.pixel.g=this.pixel.G,this.pixel.b=this.pixel.G);this.imageData=y(this.pixel);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,h.height=this.origin.height,a.putImageData(this.origin.imageData,
0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getImageData(0,0,this.origin.width,this.origin.height),this.origin.pixel=this.pixel.G!==m&&this.origin.pixel.G!==m?w(this.origin.imageData):u(this.origin.imageData));return this};k.prototype.updatePixel=function(){var a=h.getContext("2d");this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);this.width=this.imageData.width;this.height=this.imageData.height;null!==this.origin&&(h.width=this.origin.width,
h.height=this.origin.height,a.putImageData(this.origin.imageData,0,0),a.putImageData(this.imageData,this.originLeft,this.originTop),this.origin.imageData=a.getContext(0,0,this.origin.width,this.origin.height),this.origin.pixel=this.pixel.G!==m&&this.origin.pixel.G!==m?w(this.origin.imageData):u(this.origin.imageData));return this};k.prototype.update=k.prototype.updateImageData;k.prototype.paste=function(a,b,f){var e=this.width,c=this.height,d=h.getContext("2d");b=b||0;f=f||0;h.width=e;h.height=c;
d.putImageData(this.imageData,0,0);d.putImageData(a.imageData,b,f);this.imageData=d.getImageData(0,0,e,c);this.pixel=this.pixel.G!==m&&a.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.load=function(a,b,f,e){var c=new k,d=h.getContext("2d");h.width=f;h.height=e;d.putImageData(this.imageData,-a,-b);c.width=f;c.height=e;c.imageData=d.getImageData(0,0,f,e);c.pixel=u(c.imageData);c.origin=this;c.originLeft=a;c.originTop=b;c.pixel=this.pixel.G!==m?w(c.imageData):u(c.imageData);
return c};k.prototype.flip=function(a){var b=this.width,f=this.height,e=h.getContext("2d"),c=v.getContext("2d");h.width=b;h.height=f;e.translate(b/2,f/2);v.width=b;v.height=f;c.putImageData(this.imageData,0,0);0===a?e.scale(-1,1):1===a?e.scale(1,-1):2===a&&e.scale(-1,-1);e.drawImage(v,-b/2,-f/2);this.imageData=e.getImageData(0,0,b,f);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.reverse=function(){var a,b,f=this.width,e=this.height;for(b=0;b<e;b++)for(a=
0;a<f;a++)this.pixel.G!==m?this.pixel.G[b][a]=255-this.pixel.G[b][a]:(this.pixel.r[b][a]=255-this.pixel.r[b][a],this.pixel.g[b][a]=255-this.pixel.g[b][a],this.pixel.b[b][a]=255-this.pixel.b[b][a]);this.imageData=y(this.pixel);return this};k.prototype.rgba=function(){this.pixel=u(this.imageData);return this};k.prototype.rgb=function(){var a=r.blank(this.width,this.height,[255,255,255,1]);this.blend(a,1);return this};k.prototype.plot=function(a,b,f){var e,c,d,g,k,l,q,n,r,v;e="blue";var x=null,t=null,
p=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,p.putImageData(this.imageData,0,0));"number"===typeof a&&"number"===typeof b?(a=[[a,b]],b=f):"number"===typeof a[0]&&(a=[a]);/b/.test(b)?e=this.pixel.G!==m?"#1D1D1D":"#0000FF":/g/.test(b)?e=this.pixel.G!==m?"#969696":"#00FF00":/r/.test(b)?e=this.pixel.G!==m?"#4C4C4C":"#FF0000":/c/.test(b)?e=this.pixel.G!==m?"#B3B3B3":"#00FFFF":/m/.test(b)?e=this.pixel.G!==m?"#696969":"#FF00FF":/y/.test(b)?e=this.pixel.G!==m?"#E2E2E2":
"#FFFF00":/k/.test(b)?e="#000000":/w/.test(b)&&(e="#FFFFFF");1===a.length?x=null:/--/.test(b)?x="solid":/-/.test(b)?x="dashed":/:/.test(b)?x="dotted":b===m&&(x="solid");/\./.test(b)?t="dot":/o/.test(b)?t="circle":/s/.test(b)?t="square":/\*/.test(b)?t="star":/\+/.test(b)?t="plus":/x/.test(b)&&(t="cross");p.strokeStyle=e;p.fillStyle=e;for(b=0;b<a.length;b++)if(f=a[b][0],e=a[b][1],"dot"===t?(p.beginPath(),p.arc(f,e,2,0,2*Math.PI),p.fill()):"circle"===t?(p.beginPath(),p.arc(f,e,3,0,2*Math.PI),p.stroke()):
"square"===t?(p.beginPath(),p.rect(f-2,e-2,5,5),p.fill()):"star"===t?(p.beginPath(),p.moveTo(f-3,e-3),p.lineTo(f+3,e+3),p.moveTo(f-3,e+3),p.lineTo(f+3,e-3),p.moveTo(f,e-5),p.lineTo(f,e+5),p.moveTo(f-5,e),p.lineTo(f+5,e),p.stroke()):"plus"===t?(p.beginPath(),p.moveTo(f,e-5),p.lineTo(f,e+5),p.moveTo(f-5,e),p.lineTo(f+5,e),p.stroke()):"cross"===t&&(p.beginPath(),p.moveTo(f-3,e-3),p.lineTo(f+3,e+3),p.moveTo(f-3,e+3),p.lineTo(f+3,e-3),p.stroke()),0<b)if(g=a[b-1][0],k=a[b-1][1],"solid"===x)p.beginPath(),
p.moveTo(g,k),p.lineTo(f,e),p.stroke();else if("dashed"===x||"dotted"===x){"dashed"===x?(p.lineCap="butt",n=5):(p.lineCap="round",n=2);g!==f?(l=5*Math.cos(Math.atan((e-k)/(f-g))),q=5*Math.sin(Math.atan((e-k)/(f-g)))):k!==e&&(l=5*Math.sin(Math.atan((f-g)/(e-k))),q=5*Math.cos(Math.atan((f-g)/(e-k))));p.beginPath();c=g;for(d=k;Math.abs(c-g)<=Math.abs(f-g)&&Math.abs(d-k)<=Math.abs(e-k);)r=c+n/5*l,v=d+n/5*q,p.moveTo(c,d),p.lineTo(r,v),c=r+l,d=v+q;p.stroke()}!0!==this.holdon&&(this.imageData=p.getImageData(0,
0,this.width,this.height),this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData));return this};k.prototype.hold=function(){var a=h.getContext("2d");this.holdon=!0;h.width=this.width;h.height=this.height;a.putImageData(this.imageData,0,0);return this};k.prototype.flush=function(){var a=h.getContext("2d");this.holdon=!1;this.imageData=a.getImageData(0,0,this.width,this.height);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.rectangle=function(a,b,f,
e,c,d){var g=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,g.putImageData(this.imageData,0,0));c===m&&(c=[]);c[0]=c[0]||0;c[1]=c[1]||0;c[2]=c[2]||0;c[3]=c[3]||0;d===m&&(d=[]);d[0]=d[0]||0;d[1]=d[1]||0;d[2]=d[2]||0;d[3]=d[3]||0;d[4]=d[4]||0;this.pixel.G!==m&&(c[0]=.299*c[0]+.587*c[1]+.114*c[2],c[0]=Math.round(c[0]),c[1]=c[0],c[2]=c[0],d[0]=.299*d[0]+.587*d[1]+.114*d[2],d[0]=Math.round(d[0]),d[1]=d[0],d[2]=d[0]);g.fillStyle="rgba("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+
")";g.strokeStyle="rgba("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")";g.lineWidth=d[4];g.beginPath();g.rect(a,b,f,e);g.fill();g.stroke();!0!==this.holdon&&(this.imageData=g.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData));return this};k.prototype.rect=k.prototype.rectangle;k.prototype.arc=function(a,b,f,e,c,d,g){var k=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,k.putImageData(this.imageData,0,0));d===m&&(d=[]);d[0]=
d[0]||0;d[1]=d[1]||0;d[2]=d[2]||0;d[3]=d[3]||0;g===m&&(g=[]);g[0]=g[0]||0;g[1]=g[1]||0;g[2]=g[2]||0;g[3]=g[3]||0;g[4]=g[4]||0;this.pixel.G!==m&&(d[0]=.299*d[0]+.587*d[1]+.114*d[2],d[0]=Math.round(d[0]),d[1]=d[0],d[2]=d[0],g[0]=.299*g[0]+.587*g[1]+.114*g[2],g[0]=Math.round(g[0]),g[1]=g[0],g[2]=g[0]);k.fillStyle="rgba("+d[0]+", "+d[1]+", "+d[2]+", "+d[3]+")";k.strokeStyle="rgba("+g[0]+", "+g[1]+", "+g[2]+", "+g[3]+")";k.lineWidth=g[4];k.beginPath();k.arc(a,b,f,e*Math.PI/180,c*Math.PI/180);k.fill();
k.stroke();!0!==this.holdon&&(this.imageData=k.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData));return this};k.prototype.circle=function(a,b,f,e,c){return this.arc(a,b,f,0,360,e,c)};k.prototype.polygon=function(a,b,f){var e=h.getContext("2d");!0!==this.holdon&&(h.width=this.width,h.height=this.height,e.putImageData(this.imageData,0,0));b===m&&(b=[]);b[0]=b[0]||0;b[1]=b[1]||0;b[2]=b[2]||0;b[3]=b[3]||0;f===m&&(f=[]);f[0]=f[0]||0;f[1]=f[1]||0;
f[2]=f[2]||0;f[3]=f[3]||0;f[4]=f[4]||0;this.pixel.G!==m&&(b[0]=.299*b[0]+.587*b[1]+.114*b[2],b[0]=Math.round(b[0]),b[1]=b[0],b[2]=b[0],f[0]=.299*f[0]+.587*f[1]+.114*f[2],f[0]=Math.round(f[0]),f[1]=f[0],f[2]=f[0]);e.fillStyle="rgba("+b[0]+", "+b[1]+", "+b[2]+", "+b[3]+")";e.strokeStyle="rgba("+f[0]+", "+f[1]+", "+f[2]+", "+f[3]+")";e.lineWidth=f[4];e.beginPath();for(b=0;b<a.length;b++)0===b?e.moveTo(a[b][0],a[b][1]):e.lineTo(a[b][0],a[b][1]);e.closePath();e.fill();e.stroke();!0!==this.holdon&&(this.imageData=
e.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData));return this};k.prototype.poly=k.prototype.polygon;k.prototype.affine=function(a){var b=this.width,f=this.height,e=v.getContext("2d"),c=h.getContext("2d");v.width=b;v.height=f;e.putImageData(this.imageData,0,0);h.width=b;h.height=f;c.transform(a[0][0],a[1][0],a[0][1],a[1][1],a[0][2],a[1][2]);c.drawImage(v,0,0);this.imageData=c.getImageData(0,0,b,f);this.pixel=this.pixel.G!==m?w(this.imageData):
u(this.imageData);return this};k.prototype.affinec=function(a,b,f,e){var c,d,g,k,l,q=this.width,n=this.height,r=v.getContext("2d"),y=h.getContext("2d");!0===Array.isArray(a)?(g=a[0],a=a[1],!0===Array.isArray(b)&&(c=(b[0]-g)/q,k=(b[1]-a)/q),!0===Array.isArray(f)&&(d=(f[0]-g)/n,l=(f[1]-a)/n),c===m?(c=(e[0]-g-d*n)/q,k=(e[1]-a-l*n)/q):d===m&&(d=(e[0]-g-c*q)/n,l=(e[1]-a-k*q)/n)):(c=(e[0]-a[0])/q,k=(e[1]-a[1])/q,d=(f[0]-b[0]-c*q)/n,l=(f[1]-b[1]-k*q)/n,g=f[0]-d*n,a=f[1]-l*n);v.width=q;v.height=n;r.putImageData(this.imageData,
0,0);h.width=q;h.height=n;y.transform(c,k,d,l,g,a);y.drawImage(v,0,0);this.imageData=y.getImageData(0,0,q,n);this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData);return this};k.prototype.text=function(a,b,f,e){var c,d=h.getContext("2d"),g="14px",k="Arial",l=[0,0,0,1],q="start",n="top",r="normal",v="normal",x="normal";!0!==this.holdon&&(h.width=this.width,h.height=this.height,d.putImageData(this.imageData,0,0));for(c=0;c<e.length;c++){var t=e[c];"string"===typeof t?/^\d+px/.test(t)?g=t:
-1!==["start","end","center","left","right"].indexOf(t)?q=t:-1!==["top","bottom","middle","alphabetic","hanging"].indexOf(t)?n=t:-1!==["italic","oblique"].indexOf(t)?r=t:-1!==["bold","bolder","lighter"].indexOf(t)?x=t:"small-caps"===t?v=t:k=t:Array.isArray(t)&&4===t.length?l=t:"number"===typeof t&&-1!==[1,2,3,4,5,6,7,8,9].indexOf(t/100)&&(x=t)}this.pixel.G!==m&&(l[0]=.299*l[0]+.587*l[1]+.114*l[2],l[0]=Math.round(l[0]),l[1]=l[0],l[2]=l[0]);d.fillStyle="rgba("+l[0]+", "+l[1]+", "+l[2]+", "+l[3]+")";
d.textAlign=q;d.textBaseline=n;d.font=[r,v,x,g,k].join(" ");d.fillText(f,a,b);!0!==this.holdon&&(this.imageData=d.getImageData(0,0,this.width,this.height),this.pixel=this.pixel.G!==m?w(this.imageData):u(this.imageData));return this}})(window,document);